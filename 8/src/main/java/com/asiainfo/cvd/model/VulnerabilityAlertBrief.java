package com.asiainfo.cvd.model;

import lombok.Data;

import java.util.concurrent.ConcurrentHashMap;
import java.util.stream.Collectors;

@Data
public class VulnerabilityAlertBrief {

    private String issuingOrganization = "<h3 style=\"margin-left: 15px;\">• 发布组织：亚信科技TC技术委员会</h3>";

    private String reportingCycle;

    private ConcurrentHashMap<String, String> componentScope = new ConcurrentHashMap<>();

    private String dataSources = "<h3 style=\"margin-left: 15px;\">• 数据来源：</h3>";

    private String CNVD_AND_CVE = "<table style=\"display:inline-block; margin-left:30px; margin-top: 0px; margin-bottom: 0px;\"><tr><td style=\"vertical-align: top;\">- </td><td>CNVD：国家信息安全漏洞共享平台（China National Vulnerability Database），<a href=\"https://www.cnvd.org.cn/\">www.cnvd.org.cn</a>。由国家计算机网络应急技术处理协调中心联合国内重要信息系统单位、基础电信运营商、网络安全厂商、软件厂商和互联网企业建立的国家网络安全漏洞库。</td></tr><tr><td style=\"vertical-align: top;\">- </td><td>CVE ：通用漏洞披露（Common Vulnerabilities & Exposures），<a href=\"https://cve.mitre.org/\">cve.mitre.org</a>。由美国MITRE公司管理，是一个公开的、从全球范围收集的计算机安全漏洞数据库。方便安全研究者、厂商和其他利益相关者进行沟通和共享信息。</td></tr></table>";

    public void appendComponent(String component) {
        this.componentScope.put(component, component);
    }

    public String getData() {

        StringBuilder brief = new StringBuilder();
        brief.append(issuingOrganization);
        brief.append("<h3 style=\"margin-left: 15px;\">• 报告周期：").append(reportingCycle.replace("-","/").replace("_"," - ")).append("</h3>");
        brief.append(dataSources);
        brief.append(CNVD_AND_CVE);
        brief.append("<h3 style=\"margin-left: 15px;\">• 涉及组件：").append(componentScope.keySet().stream().map(key -> key).collect(Collectors.joining(", "))).append("</h3>");

        return brief.toString();
    }
}
